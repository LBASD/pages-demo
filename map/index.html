<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>å›ºæœ¬ç„¶å…¨å›½äº§ä¸šå¸ƒå±€å›¾</title>
    <script
      type="text/javascript"
      src="https://registry.npmmirror.com/jquery/3.7.1/files/dist/jquery.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://registry.npmmirror.com/echarts/5.5.1/files/dist/echarts.min.js"
    ></script>
    <script src="./js/viewer.js"></script>

    <link rel="stylesheet" href="./css/viewer.css" />
    <style>
      * {
        padding: 0;
        margin: 0;
      }

      #chart-panel {
        width: calc(100vw - 200px);
        height: calc(100vh - 200px);
        padding: 100px;
        margin: 0 auto;
      }

      @media screen and (max-width: 600px) {
        #chart-panel {
          padding: 0;
          padding-top: 40px;
          width: 100vw;
          height: 100vw;
          box-sizing: border-box;
        }
      }
    </style>

    <script type="text/javascript" src="./china.js"></script>
  </head>
  <body>
    <!-- ä¸º ECharts å‡†å¤‡ä¸€ä¸ªå®šä¹‰äº†å®½é«˜çš„ DOM -->
    <div id="chart-panel"></div>

    <ul id="images" style="display: none">
      <li><img src="./images/tibet-1.jpg" alt="Picture 1" /></li>
      <li><img src="./images/1.jpg" alt="Picture 1" /></li>
      <li><img src="./images/1.png" alt="Picture 1" /></li>
      <li><img src="./images/2.jpg" alt="Picture 1" /></li>
    </ul>
    <script type="text/javascript">
      // åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹
      var myChart = echarts.init(document.getElementById("chart-panel"));
      // æŒ‡å®šå›¾è¡¨çš„é…ç½®é¡¹å’Œæ•°æ®
      var option = {};

      //=============== start ===============//
      /**
       * ğŸš¨ğŸš¨éå¸¸é‡è¦ğŸš¨ğŸš¨
       * ä¸‹é¢æ˜¯ ç½‘ç«™å·¦ä¾§ä»£ç ï¼Œæ ¸å¿ƒä»£ç 
       */
      const data = [
        { name: "é’æµ·", value: 3 },
        { name: "é™•è¥¿", value: 9 },
        { name: "ç”˜è‚ƒ", value: 1 },
        { name: "æ¹–åŒ—", value: 4 },
        { name: "æ²³å—", value: 1 },
        { name: "æ–°ç–†", value: 4 },
        { name: "å±±è¥¿", value: 2 },
        { name: "å®å¤", value: 14 },
        { name: "å‰æ—", value: 1 },
        { name: "å†…è’™å¤", value: 1 },
      ];

      var geoCoordMap = {
        é™•è¥¿: [108.948024, 34.263161],
        é’æµ·: [96.778916, 35.623178],
        ç”˜è‚ƒ: [103.823557, 36.058039],
        æ¹–åŒ—: [113.298572, 30.684355],
        æ²³å—: [113.665412, 33.757975],
        æ–°ç–†: [85.617733, 40.792818],
        å±±è¥¿: [111.849248, 36.857014],
        å®å¤: [106.278179, 37.26637],
        å‰æ—: [125.3245, 41.886841],
        å†…è’™å¤: [111.670801, 41.818311],
      };

      function convertData(data) {
        var res = [];
        for (var i = 0; i < data.length; i++) {
          var geoCoord = geoCoordMap[data[i].name];
          if (geoCoord) {
            res.push({
              name: data[i].name,
              value: geoCoord.concat(data[i].value),
            });
          }
        }
        return res;
      }

      option = {
        title: {
          text: "å›ºæœ¬ç„¶å…¨å›½äº§ä¸šå¸ƒå±€å›¾",
          left: "center",
        },
        tooltip: {
          trigger: "item",
          // showDelay: 0,
          // transitionDuration: 0.2,
        },
        // visualMap: {
        //   left: "right",
        //   min: 1,
        //   max: 15,
        //   inRange: {
        //     color: [
        //       "#abd9e9",
        //       "#e0f3f8",
        //       "#ffffbf",
        //       "#fee090",
        //       "#fdae61",
        //       "#f46d43",
        //     ],
        //   },
        //   text: ["High", "Low"],
        //   calculable: true,
        //   realtime: false,
        // },
        geo: {
          name: "å›¾ç‰‡æ•°é‡",
          map: "china",
          roam: false,
          selectedMode: "single",
          // layoutCenter: ['100%', '100%'],
// å¦‚æœå®½é«˜æ¯”å¤§äº 1 åˆ™å®½åº¦ä¸º 100ï¼Œå¦‚æœå°äº 1 åˆ™é«˜åº¦ä¸º 100ï¼Œä¿è¯äº†ä¸è¶…è¿‡ 100x100 çš„åŒºåŸŸ
// layoutSize: 450,
          label: {
            normal: {
              show: true,
              textStyle: {
                color: "rgba(0,0,0,0.6)",
              },
            },
          },
          itemStyle: {
            normal: {
              borderColor: "rgba(0, 0, 0, 0.2)",
              areaColor: "#eee",
            },
            emphasis: {
              borderColor: "rgba(0, 255, 0, 1)",
              areaColor: "rgba(0, 255, 0, 1)",
              // shadowOffsetX: 0,
              // shadowOffsetY: 0,
              // shadowBlur: 20,
              // borderWidth: 0,
              // shadowColor: "rgba(0, 0, 0, 0.5)",
            },
          },
        },
        series: [
          {
            type: "scatter",
            coordinateSystem: "geo",
            data: convertData(data),
            symbolSize: 20,
            symbol: `image://./flag.png`,
            symbolRotate: 0,
            symbolOffset: ["50%", "-100%"],
            tooltip: {
              show: false,
              trigger: "none",
            },
            label: {
              show: false,
            },
          },
          {
            name: "å›¾ç‰‡æ•°é‡",
            type: "map",
            scaleSize: 1.2,
            geoIndex: 0,
            tooltip: {
              show: false,
            },
            data: data,
          },
        ],
      };
      //=============== end ===============//

      // ä½¿ç”¨åˆšæŒ‡å®šçš„é…ç½®é¡¹å’Œæ•°æ®æ˜¾ç¤ºå›¾è¡¨ã€‚
      if (option && typeof option === "object") {
        myChart.setOption(option);
      }
      window.addEventListener("resize", myChart.resize);
      // ç›‘å¬åœ°å›¾ç‚¹å‡»äº‹ä»¶
      myChart.on("click", function (params) {
        if (params.componentType === "series" && params.seriesType === "map") {
          console.log("ä½ ç‚¹å‡»äº†ï¼š" + params.name + "å›¾ç‰‡æ•°é‡:" + params.value);
          if (params.value > 0) {
            previewImg();
          }else {
            setTimeout(function () {
              alert(params.name + 'æ²¡æœ‰ç›¸å…³ä¿¡æ¯');
            },500)
          }
        }
      });

      function previewImg() {
        var viewer = new Viewer(document.getElementById("images"), {
          button: false, // å³ä¸Šè§’å…³é—­æŒ‰é’®
          title: false, // æ ‡é¢˜
          toolbar: {
            oneToOne: true,
            oneToOne: "large",
            prev: "large",
            // prev: function () {
            //   viewer.prev(true);
            // },
            // play: true,
            next: "large",
            // next: function () {
            //   viewer.next(true);
            // },
          },

          hidden: function () {
            viewer.destroy();
          },
        });
        viewer.show();
      }
    </script>
  </body>
</html>
